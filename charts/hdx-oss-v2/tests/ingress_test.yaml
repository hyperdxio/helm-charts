suite: Test Ingress
templates:
  - ingress.yaml
tests:
  - it: should not render ingress when disabled
    set:
      hyperdx:
        ingress:
          enabled: false
    asserts:
      - hasDocuments:
          count: 0
          
  - it: should render ingress correctly when enabled without TLS
    set:
      hyperdx:
        ingress:
          enabled: true
          host: hyperdx.example.com
          proxyBodySize: 100m
          proxyConnectTimeout: "60"
          proxySendTimeout: "60"
          proxyReadTimeout: "60"
          tls:
            enabled: false
    asserts:
      - isKind:
          of: Ingress
      - equal:
          path: spec.rules[0].host
          value: hyperdx.example.com
      - matchSnapshot:
          path: metadata.annotations
          
  - it: should render ingress with TLS when enabled
    set:
      hyperdx:
        ingress:
          enabled: true
          host: hyperdx.example.com
          tls:
            enabled: true
            secretName: hyperdx-tls
    asserts:
      - isKind:
          of: Ingress
      - equal:
          path: spec.rules[0].host
          value: hyperdx.example.com
      - equal:
          path: spec.tls[0].secretName
          value: hyperdx-tls 